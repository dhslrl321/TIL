# 종류

- **DTO**
  - `SessionRequest`
  - `SessionResponse`
- **Config**
  - `SecurityJavaConfig`
    - WebSecurityConfigurerAdapter : 사용자 자체 보안 구성을 할 때 사용됨
    - 구현
      - Filter들을 등록
      - 연결 session 관리, (최대 사용자 연결 수 지정 가능 등)
      - SessionCreationPolicy.STATELESS 로 설정해서 세션 쿠키 인증 방식을 하지 않겠다고 지정
      - csrf()는 토큰 기반 인증에서 방지가 됨
      - exceptionHandling() 으로 예외 처리 기능이 작동하게 함
      - authenticationEntryPoint() 로 인증 실패시 처리
        - 여기에 HttpStatus.UNAUTHROIZED 면 실패로 봄
  - ## 구현
- **Filter**
  - `JwtAuthenticationFilter`
    - BasicAuthenticationFilter : SecurityFilterChain 중 하나로 BASIC Authentication Header 에 값을 검증할 때 주로 사용됨
    - 구현
      - BASIC 인증 방식을 이용할 때 쓰는 필터를 이용해서 커스텀하기
      - doFilterInternal 에서 ServletRequest 에 존재하는 header 값 추출
      - header 에 토큰이 null 이 아니면 복호화 해서 정보 확인
      - expiredAt 과 현재 시간을 비교해서 refresh token 생성 여부 고민
      - 토큰 복호화해서 Claims 꺼내고 권한 정보 만들어서 Authentication 생성
      - SecurityContextHolder에 Authentication 저장
      - 다른 서블릿 필터들이 동작하도록 doFilter 호출
  - `AuthenticationErrorFilter`
    - HttpFilter : Filter 인터페이스의 기본 구현체
    - 구현
      - JwtAuthenticationFilter 앞에 위치
      - InvalidTokenException이 발생하면 HttpStatus.UNAUTHORIZED 응답
- **Security**
  - `UserAuthentication`
    - AbstractAuthenticationToken
    - 구현
      - 생성자로 userId, role(Collections)를 받고 AbstractAuthenticationToken에 권한을 넣어줌
      - role를 넣어줄 때, SimpleGrantedAuthority 객체로 넣음
- **Exceptions**
  - `LoginFailException`
  - `InvalidTokenException`
- **Utils**
  - `JwtUtils`
- **MVC**
  - `AuthenticationService`
    - login() 로그인 수행: encoded된 토큰 String 반환
      - findByEmail로 User 엔티티 받아오기
      - 사용자 이메일이 없으면 LoginFailException 발생
      - 비밀번호가 맞지 않으면 LoginFailException 발생
    - parseToken() accessToken 매개변수로 받아서 토큰을 발급받은 사용자 id 반환
    - roles()
  - `SessionController`

# WebSecurityConfigurerAdapter

- Spring Security 자동 구성이 비활성화되고 사용자 지정 보안 구성
- `@EnableWebSecurity`와 함께 구성

# AbstractAuthenticationToken

- 권한으로 토큰을 생성

### SimpleGrantedAuthority

- 권한을 저장하는 객체
- 생성자 파라미터에 넣는 것으로 권한 객체 생성
